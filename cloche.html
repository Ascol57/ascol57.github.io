<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soundbox Pro - Z√©ro Latence</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            user-select: none; /* √âvite de s√©lectionner le texte en bourrinant les boutons */
        }

        h1 { margin-bottom: 30px; letter-spacing: 2px; text-transform: uppercase; font-size: 1.5rem;}

        /* --- Bouton d'activation --- */
        #btn-init {
            background-color: #e74c3c;
            color: white;
            padding: 20px 40px;
            font-size: 18px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
            transition: all 0.2s ease;
            margin-bottom: 50px;
            font-weight: bold;
            text-align: center;
        }
        #btn-init:hover { transform: scale(1.05); }
        #btn-init:active { transform: scale(0.95); }
        
        #btn-init.active { 
            background-color: #27ae60; 
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.6);
            cursor: default;
        }

        /* --- Grille des sons --- */
        .sound-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            width: 80%;
            max-width: 600px;
        }

        .sound-btn {
            background-color: #34495e; /* Couleur par d√©faut (non charg√©) */
            color: #bdc3c7;
            border: none;
            padding: 30px 20px;
            font-size: 16px;
            border-radius: 12px;
            cursor: not-allowed;
            transition: all 0.1s;
            position: relative;
            overflow: hidden;
            font-weight: bold;
        }

        /* Quand le son est charg√© en RAM */
        .sound-btn.loaded {
            background-color: #3498db;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 0 #2980b9; /* Effet 3D */
        }

        .sound-btn.loaded:active { 
            transform: translateY(4px); /* Effet d'enfoncement */
            box-shadow: 0 0 0 #2980b9; 
            background-color: #5dade2;
        }

        /* D√©sactiv√© tant que le syst√®me n'est pas ON */
        .sound-grid.locked {
            opacity: 0.5;
            pointer-events: none;
        }

        .status { margin-top: 30px; color: #7f8c8d; font-size: 0.8em; font-family: monospace;}
    </style>
</head>
<body>

    <h1>üöÄ Soundbox Z√©ro Latence</h1>

    <button id="btn-init" onclick="unlockAudioSystem()">
        CLIQUER POUR ACTIVER<br>
        <small style="font-weight:normal; font-size:0.7em">(Et tuer le buzz)</small>
    </button>

    <div class="sound-grid locked" id="grid">
        
        <button class="sound-btn" data-url="https://constant.rusche.fr/ClocheV2.mp3" data-key="cloche">
            Chargement...
        </button>

        <button class="sound-btn" data-url="https://www.soundjay.com/buttons/sounds/button-10.mp3" data-key="beep">
            Chargement...
        </button>

    </div>

    <div class="status" id="status-text">Initialisation...</div>

    <script>
        // --- 1. CONFIGURATION ---
        // Le contexte audio est cr√©√© mais "suspendu" jusqu'au clic utilisateur
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        
        // Banque de sons (stock√©s en RAM)
        const soundBuffers = {};

        // --- 2. FONCTIONS DE CHARGEMENT (LE SECRET DE LA RAPIDIT√â) ---
        
        // Cette fonction t√©l√©charge et d√©code le son en binaire
        async function loadSound(url) {
            try {
                const response = await fetch(url);
                const arrayBuffer = await response.arrayBuffer();
                // D√©codage asynchrone pour transformer le MP3 en donn√©es brutes pr√™tes √† jouer
                const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
                return audioBuffer;
            } catch (error) {
                console.error("Erreur chargement son:", url, error);
                return null;
            }
        }

        // On scanne tous les boutons HTML pour charger leurs sons
        async function initSoundLoader() {
            const buttons = document.querySelectorAll('.sound-btn');
            
            for (const btn of buttons) {
                const url = btn.getAttribute('data-url');
                const key = btn.getAttribute('data-key');

                // T√©l√©chargement...
                const buffer = await loadSound(url);

                if (buffer) {
                    // Stockage en m√©moire
                    soundBuffers[key] = buffer;
                    
                    // Mise √† jour visuelle du bouton
                    btn.innerText = key.toUpperCase(); // Ou mettre un texte personnalis√©
                    btn.classList.add('loaded');
                    
                    // Ajout du d√©clencheur au clic
                    btn.onclick = () => playBuffer(key);
                } else {
                    btn.innerText = "ERREUR";
                    btn.style.backgroundColor = "#c0392b";
                }
            }
            document.getElementById('status-text').innerText = "Sons charg√©s en m√©moire. En attente d'activation.";
        }

        // --- 3. FONCTION DE LECTURE INSTANTAN√âE ---
        function playBuffer(key) {
            if (!soundBuffers[key]) return;

            // On cr√©e une "source" √©ph√©m√®re pour chaque son jou√©
            // C'est ce qui permet la polyphonie (plusieurs sons en m√™me temps)
            const source = audioCtx.createBufferSource();
            source.buffer = soundBuffers[key];
            source.connect(audioCtx.destination);
            source.start(0); // 0 = imm√©diat
        }

        // --- 4. ACTIVATION DU SYST√àME (ANTI-BUZZ + D√âVERROUILLAGE) ---
        function unlockAudioSystem() {
            // Reprise du contexte audio (n√©cessaire pour les navigateurs modernes)
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            // --- L'OSCILLATEUR ANTI-BUZZ (Ta demande initiale) ---
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.value = 19000; // 19kHz (Inaudible)
            gainNode.gain.value = 0.00001;      // Volume infinit√©simal

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            // ----------------------------------------------------

            // Interface
            const btnInit = document.getElementById('btn-init');
            btnInit.innerHTML = "SYST√àME ACTIF ‚úÖ";
            btnInit.classList.add('active');
            
            // On d√©bloque la grille
            document.getElementById('grid').classList.remove('locked');
            document.getElementById('status-text').innerText = "Pr√™t √† faire du bruit.";
        }

        // Lancer le chargement des sons d√®s que la page s'ouvre
        window.addEventListener('load', initSoundLoader);

    </script>
</body>
</html>

